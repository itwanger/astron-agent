## 人设需求开发文档

### 开发须知

开发前请详细阅读该文档，并按步骤进行代码开发，上一步完成且确认无误后再开始下一步操作。

我会将该需求进行详细描述，帮我完成前端代码开发，使用antd组件，样式方面简单即可，我会后面根据UI进行还原

### 开发内容

本次开发的内容为：

1. 智能体调试页面--高阶配置tab--对话增强--“输入示例”下方；添加“角色人设”一项，该项通过右侧的switch按钮打开后，包含“人设信息”和“场景信息”两列设置项；
2. “角色人设”该项的显示布局同现有设置（输入实例）一样，左侧为该项名称，右侧为switch按钮；按钮点击后，出现下面的两项（“人设信息”和“场景信息”）；
3. “人设信息” 项为上下布局，上方的左侧为该项名称，右侧为蓝色字体“精品人设库”，点击后出现人设库弹窗（该弹窗需求后面详述）；下方为一个文本框，placeholder为“请输入角色人设”，限制输入500字符（文本框内右下角显示），文本框左下角有个按钮对应的文案信息为“AI生成”，当用户输入文本后，按钮文案变为“AI润色”；
4. “场景信息”项也是上下布局，但占据三列，最上面一列，左侧为该项名称，中介列为两个各占据一半宽度（中间有间隔）的场景选项标签，一个是“陪伴场景”（标题描述：适用于闲聊陪伴，交流娱乐），一个是“陪练场景”（标题描述：适用于面试工作，学习练习），两个标签都是(padding: 16px 13px；每个标签左侧为一个icon占据一竖列和上下布局对应的标题，标题描述，共占据一竖列，右侧为一个圆形复选框)，点击整个标签后复选框变为对号（有对应的svg图），且整个标签边框变蓝，默认选中“陪伴场景”；
   最下面的列是文本框，placeholder为“文案内容字数控制在500字以内”，限制输入500字符（不用显示该限制），框内右下角显示一个画笔额的图标，注意：该输入框在未选择场景标签时不出现
5. 这两项选中后，都要将对应字段（人设信息，场景信息（陪伴还是陪练），场景描述）放入创建或者更新智能体的接口中；如果没有选择显示角色人设的switch，这几项则默认传null即可；
6. 人设库弹窗需求：
7. 为一个弹窗，默认宽769px, 高619px
8. 弹窗标题：“精品人设库”，16px
9. 标题下是一个tab行（根据后端返回的人设类型来显示，应该是全部tab，和对应的每个具体类别），点击tab时字体颜色变为#6356EA，且tab文字下方出现对应颜色的横线，14px字体大小
10. tab行下方是卡片列表区域，每行三列，卡片布局为：


    + padding: 10px
    + 左侧圆形人设图片，右侧上方是人设名称（14px），下方是人设描述(12px)
    + 点击卡片，边框变色border: 1px solid #6356EA，且右上角（跟人设名称同一行）出现“详情”（12px）按钮，点击详情出现人设详情页弹窗，正好盖住人设库弹窗
    + 人设详情弹窗布局: 宽高跟人设库弹窗一致， 弹窗标题为“精品人设库”，下方是整个内容区（左右两列），左侧为对应的人设图片，右侧为人设描述（后端返回）；人设描述底部是两个按钮“返回”，“选择”，点击返回关闭详情弹窗，点击选择关闭详情和人设库弹窗，将对应的人设描述带回“人设信息”的文本框内

### 开发要求

1. 组件名称按照 xxx-xxx的形式创建，使用详细的TS，避免使用any类型
2. 组件位置位于当前md文件所在文件夹
3. 本次开发的该组件（人设详情弹窗没创建对应文件）已创建文件（src\pages\ConfigPage\ConfigBase\components\personality-component\index.tsx），放置在 CapabilityDevelopment.tsx 组件内（已引入import Personality from './personality-component';）
4. 开发前需要查阅CapabilityDevelopment.tsx及ConfigBase\index.tsx组件的具体逻辑，了解本次添加的高阶配置中这几项如何放入对应的创建及更新智能体接口；
5. 本次开发的接口数据请先行自定义（按照功能实现来），放在src\services\agent-personality.ts中 ，已定义好一个
6. 我在personality-component已写好基础的布局（角色人设标题和对应的switch）, 请接着往下开发
7. 忽略现在使用的tailwind css，仍使用module.scss进行开发

### 接口开始联调及逻辑补充：

#### 调整1

1. 角色人设中的信息 对应的字段需要调整：

- switch开关对应的字段名称改为: enablePersonality, 需要向创建、保存、更新接口中添加；
  但是获取智能体详情时，接口中不会有改字段，switch回显是否打开要看接口中的personalityConfig是否为null, 为null则说明改智能体没有角色人设的配置项
- 现在的角色人设中的三个配置项 人设信息，场景信息，场景描述，分别改为 personality, sceneType(1为陪伴场景, 2为陪练场景), sceneInfo, 并将这三项直接放入 personalityConfig 对象中, 然后向创建、保存、更新接口中添加；
  这是跟后端所需入参做同步
- 当用户没有打开角色人设这个switch时, personalityConfig 中各项可以都不填，那此时我向接口中传参 enablePersonality 需置为false, 这样后端不用处理personalityConfig中各项信息了, 但我回显时仍是看 personalityConfig是否为null

2. 场景信息需要调整逻辑：

- 没有默认的场景类型，该字段可以不选择, 现在默认是陪伴场景了
- 回显时也是如此

3. AI润色与AI生成接口的调用:

- 现在是鼠标移入人设信息框内，该按钮就不可见了，帮我处理下，需要一直显示 （是因为鼠标移入变白色字体了吗?）
- AI润色和生成对应的接口我已经写好，相关信息在接口类型中定义了，请查看后协助处理对应逻辑
- 接口中所需的入参botName, category, info 分别对应ConfigBase组件中的baseinfo的botName、botType、botDesc，prompt对应ConfigBase组件中的prompt, personality对应用户已输入的人设信息；
  所以用户没输入任何人设信息时，用AI生成接口，不需要传personality
- 这里接口需要的入参是不是没有传入personality-component组件，没有的话帮我调整及补充

#### 调整2

1. 确认：当前角色人设的switch开关关闭后，是否还会向创建、更新等接口传数据？只需确认即可
2. 向ConfigBase组件中使用的PromptTry和PromptTip组件传入角色人设信息(personalityConfig), 如果switch为关闭状态, 则不用传, 仿照现在这两个组件的prompt参数的使用，也把这个personalityConfig放入sse接口中(跟其他一样使用form.append的方式处理)

#### 调整3

1. 将personality-component组件中的两个弹窗提取出来，单独放在personality-component这个文件夹下，使用xxx-xxx全小写的命名方式；
2. 对于精品人设库弹窗，使用getPersonalityCategory接口获取personalityTypes，然后显示的列表数据，是使用 getPersonalityByCategory 接口去调用 personalityTypes 中每个类型对应的id（第一个类型后端默认返回 “全部”）

### 缺陷修复

#### 第一版修复

1. 人设信息的文本框中，输入过多文字时，会盖住AI生成/润色的按钮，需要将文本框底部设置padding或什么，以使得按钮不被遮盖
2. 当填写了任意角色人设信息时，即使已保存，但详情接口是不会返回角色人设的switch开关对应字段的，此时应该去判断personalityConfig 中有无内容来回显switch是否打开，有则打开；
   之前应该有做，但是目前没效果，无论personalityConfig有无，查看智能体详情进来都是关闭的
3. 场景信息，应该再次点击时就不勾选，而不是点击一次就无法取消了
   注意：取消勾选后场景描述也应清空

#### 第二版修复

1. 角色人设的相关配置项不做任何变动，只是在configbase组件中切换绑定value为model 的select组件时，此时再去保存，偶现：保存接口入参enablePersonality变为false, 但personalityConfig仍传对应数据，这是为什么？
   （我确认点击智能体后，只在里面切换了select中的模型选项，其他都没动配置，然后点保存，两三次中有一次会出现enablePersonality自动变为false的情况，目前尝试在handlePersonalityChange中使用useCallback解决，还是不行）
2. 需补充：
3. 当角色人设的switch打开时，人设信息是需要必填的，未填写的话点击创建和保存按钮都需要提示用户填写；
4. 场景信息是非必填的，但是场景信息中一旦选中任意一个场景类型，那此时场景描述也需要必填（一般场景类型选中会带上对应的描述，但可能存在用户删去描述忘记填写的情况），如果未填写的话点击创建和保存按钮都需要提示用户填写
5. 对于上述的两个逻辑，帮我优化，使用message.info进行提示
